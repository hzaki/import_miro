name: Push Story Mapping R4 to Miro (IT CALF)

on:
  workflow_dispatch:
    inputs:
      prefix:
        description: "Préfixe des frames (idempotence légère)"
        type: string
        default: "R4"
        required: true
      csv_path:
        description: "Chemin vers un CSV dans le repo (ex: data/storymap_r4.csv)"
        type: string
        required: false
      dry_run:
        description: "Ne pas écrire dans Miro, seulement afficher"
        type: choice
        options: ["true", "false"]
        default: "true"
        required: true

jobs:
  run:
    runs-on: ubuntu-latest
    env:
      MIRO_TOKEN: ${{ secrets.MIRO_TOKEN }}
      MIRO_BOARD_ID: ${{ secrets.MIRO_BOARD_ID }}
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - run: pip install -r requirements.txt || pip install requests pandas python-slugify
      - name: Exécuter le script Story Mapping R4
        run: |
          args=( --board "$MIRO_BOARD_ID" --prefix "${{ inputs.prefix }}" )
          if [ -n "${{ inputs.csv_path }}" ]; then
            args+=( --csv "${{ inputs.csv_path }}" )
          fi
          if [ "${{ inputs.dry_run }}" = "true" ]; then
            args+=( --dry-run )
          fi
          python push_storymap_r4_to_miro.py "${args[@]}"
